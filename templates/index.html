<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mirror.ia</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üéôÔ∏è</text></svg>">
    <!-- FontAwesome (Local) -->
    <link rel="stylesheet" href="/static/vendor/fontawesome-free-6.5.1-web/css/all.min.css">

    <!-- Chart.js and WaveSurfer (Local) -->
    <script src="/static/vendor/chart.min.js"></script>
    <script src="/static/vendor/wavesurfer.min.js" defer></script>
    <link rel="stylesheet" href="/static/style.css?v={{ cache_bust }}">

    <style>
        /* Failsafe Icon Styling */
        i.fa-solid,
        i.fa-regular,
        i.fa-brands,
        i.fas,
        i.far,
        i.fab {
            display: inline-block;
            min-width: 1em;
            min-height: 1em;
            text-align: center;
            font-style: normal;
            text-rendering: auto;
            -webkit-font-smoothing: antialiased;
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
        }

        /* Fallback removed */
    </style>
</head>

<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo-area">
                <i class="fa-solid fa-wave-square" style="font-size: 1.5rem;"></i>
                <span>Mirror.ia</span>
            </div>

            <button class="sidebar-toggle" id="sidebar-toggle" title="Colapsar sidebar">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="15 18 9 12 15 6"></polyline>
                </svg>
            </button>

            <nav class="nav-links">
                <a href="#" class="nav-item active" id="dashboard-link">
                    <i class="fa-solid fa-th-large"></i>
                    <span>Dashboard</span>
                </a>
                </a>
                <a href="#" class="nav-item" id="report-link">
                    <i class="fa-solid fa-chart-pie"></i>
                    <span>Relat√≥rios</span>
                </a>
                <a href="#" class="nav-item" id="join-qld-link">
                    <i class="fa-solid fa-file-invoice"></i>
                    <span>Juntar (QLD)</span>
                </a>
                <a href="#" class="nav-item" id="join-cap-link">
                    <i class="fa-solid fa-file-contract"></i>
                    <span>Juntar (CAP)</span>
                </a>
                <a href="#" class="nav-item hidden" id="admin-link">
                    <i class="fa-solid fa-user-shield"></i>
                    <span>Admin</span>
                </a>
                <a href="#" class="nav-item hidden" id="terminal-link">
                    <i class="fa-solid fa-terminal"></i>
                    <span>Terminal</span>
                </a>
                <a href="#" class="nav-item" id="export-link">
                    <i class="fa-solid fa-file-export"></i>
                    <span>Exportar</span>
                </a>
            </nav>

            <div class="nav-footer">
                <div class="theme-toggle" id="theme-toggle">
                    <i class="fa-solid fa-sun" id="theme-icon"></i>
                    <span class="toggle-label">Modo Claro</span>
                </div>
                <div class="theme-toggle" id="logout-btn" style="margin-top: 8px; cursor: pointer;">
                    <i class="fa-solid fa-sign-out-alt"></i>
                    <span>Sair</span>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- DASHBOARD VIEW -->
            <div id="dashboard-view">
                <div class="header-bar">
                    <div class="page-title flex items-center gap-16">
                        <div class="logo-box">
                            <span class="wave-bar"></span>
                            <span class="wave-bar"></span>
                            <span class="wave-bar"></span>
                            <span class="wave-bar"></span>
                            <span class="wave-bar"></span>
                        </div>
                        <div>
                            <h1 class="header-title">Mirror.ia</h1>
                            <p class="header-subtitle">Sua voz, refletida em intelig√™ncia.</p>
                        </div>
                    </div>
                    <div id="user-limit-badge" class="usage-badge">
                        <i class="fa-solid fa-chart-bar"></i>
                        <div class="usage-badge-info">
                            <span class="usage-badge-label">Transcri√ß√µes</span>
                            <span id="usage-display" class="usage-badge-value">- / -</span>
                        </div>
                    </div>
                </div>

                <!-- Upload Area -->
                <div class="glass-card upload-zone" id="upload-zone">
                    <input type="file" id="file-input" multiple hidden accept="audio/*,video/*">
                    <i class="fa-solid fa-cloud-arrow-up upload-zone-icon"></i>
                    <h3 class="upload-zone-title">Arraste seus arquivos</h3>
                    <p class="upload-zone-subtitle">ou clique para selecionar</p>
                    <button class="btn-primary btn-upload-trigger">
                        <i class="fa-solid fa-upload"></i>
                        Selecionar Arquivos
                    </button>
                </div>

                <!-- Status Section -->
                <div id="status-section" class="status-list hidden mb-32">
                    <h3 class="status-section-title">Em Processamento</h3>
                    <div id="inprogress-list"></div>
                </div>

                <!-- History Section -->
                <div class="glass-card">
                    <div class="section-header"
                        style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px">
                        <div style="display:flex; align-items:center; gap:8px">
                            <i class="fa-solid fa-history" style="color:var(--primary); font-size:1.2rem"></i>
                            <h3 style="margin:0">Hist√≥rico</h3>
                        </div>
                        <button class="action-btn" id="btn-clear-history" title="Limpar Hist√≥rico"><i
                                class="fa-solid fa-trash"></i></button>
                    </div>

                    <div id="empty-state" class="empty-state hidden">
                        <div class="empty-icon"><i class="fa-regular fa-folder-open"></i></div>
                        <p>Nenhuma transcri√ß√£o encontrada</p>
                    </div>

                    <table id="history-table" style="width:100%; border-collapse:collapse; margin-top:16px">
                        <thead>
                            <tr
                                style="text-align:left; color:var(--text-muted); font-size:0.85rem; border-bottom:1px solid var(--border)">
                                <th style="padding:12px; font-weight:500">Arquivo</th>
                                <th style="padding:12px; font-weight:500">Data</th>
                                <th style="padding:12px; font-weight:500; cursor:pointer; user-select:none"
                                    onclick="toggleSort('duration')">
                                    Dura√ß√£o
                                    <i id="sort-duration-icon" class="fa-solid fa-sort"
                                        style="font-size:0.9em; vertical-align:middle; margin-left:4px"></i>
                                </th>
                                <th style="padding:12px; font-weight:500">Status</th>
                                <th style="padding:12px; font-weight:500">A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="history-body">
                            <!-- JS renders rows -->
                        </tbody>
                    </table>
                </div>

                <!-- Result Modal -->
                <div class="modal-overlay" id="result-modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <!-- Removed 'Detalhes da Transcri√ß√£o' -->
                            <button class="action-btn" id="btn-close-modal" style="margin-left:auto;"><i
                                    class="fa-solid fa-times" style="font-size:1.2rem;"></i></button>
                        </div>
                        <div id="result-meta" style="margin-bottom:16px; color:var(--text-muted); font-size:0.9rem;">
                        </div>

                        <!-- Custom Audio Player -->
                        <div class="audio-player-container hidden" id="audio-player">
                            <!-- Waveform Container -->
                            <div id="waveform" style="width: 100%; margin-bottom: 12px;"></div>

                            <div class="controls-row" style="display:flex; align-items:center; gap:16px;">
                                <button class="player-btn" id="play-pause-btn">
                                    <i class="fa-solid fa-play" id="play-icon"></i>
                                </button>
                                <span id="current-time" class="time-display">0:00</span>
                                /
                                <span id="duration-display" class="time-display">0:00</span>

                                <div class="volume-container" style="margin-left:auto;">
                                    <i class="fa-solid fa-volume-up" id="volume-icon"></i>
                                    <input type="range" class="volume-slider" id="volume-slider" min="0" max="1"
                                        step="0.1" value="1">
                                </div>
                            </div>
                        </div>

                        <div class="tabs" style="margin-top:10px;">
                            <button class="tab-btn active" onclick="switchResultTab('text', this)">Transcri√ß√£o</button>
                            <button class="tab-btn" onclick="switchResultTab('summary', this)">Resumo IA üß†</button>
                            <button class="tab-btn" onclick="switchResultTab('topics', this)">T√≥picos üè∑Ô∏è</button>
                            <button class="tab-btn" onclick="switchResultTab('notes', this)">Anota√ß√µes üìù</button>
                        </div>

                        <div id="tab-content-text" class="tab-content active">
                            <!-- Search Bar -->
                            <div style="margin-bottom: 8px; position:relative;">
                                <i class="fa-solid fa-search"
                                    style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); color: var(--text-muted);"></i>
                                <input type="text" id="transcription-search"
                                    placeholder="Buscar na transcri√ß√£o... (Enter para pr√≥xima)"
                                    style="width: 100%; padding: 8px 8px 8px 32px; background: var(--bg-input); border: 1px solid var(--border); border-radius: 6px; color: var(--text);">
                            </div>
                            <!-- Rich content div instead of Textarea -->
                            <div id="result-text" class="result-content"
                                style="white-space: pre-wrap; height: 300px; overflow-y: auto; background: var(--bg-input); padding: 12px; border-radius: 8px; border: 1px solid var(--border);">
                            </div>
                        </div>
                        <div id="tab-content-summary" class="tab-content">
                            <div style="display: flex; justify-content: flex-end; margin-bottom: 8px;">
                                <button class="action-btn" id="btn-regenerate-analysis" onclick="regenerateAnalysis()"
                                    style="border: 1px solid var(--primary); color: var(--primary); padding: 6px 12px; display: flex; align-items: center; gap: 6px; font-size: 0.85rem;">
                                    <i class="fa-solid fa-sync"></i> Regenerar An√°lise
                                </button>
                            </div>
                            <div id="result-summary" class="ai-content">
                                <p style="color:var(--text-muted)">Gerando an√°lise...</p>
                            </div>
                        </div>
                        <div id="tab-content-topics" class="tab-content">
                            <div id="result-topics" class="ai-content">
                                <p style="color:var(--text-muted)">Extraindo t√≥picos...</p>
                            </div>
                        </div>
                        <div id="tab-content-notes" class="tab-content">
                            <textarea id="notes-area" class="result-textarea"
                                placeholder="Adicione anota√ß√µes manuais aqui... (Salvo automaticamente)"
                                style="width: 100%; height: 300px; padding: 12px; border-radius: 8px; border: 1px solid var(--border); background: var(--bg-input); color: var(--text); resize: vertical;"></textarea>
                        </div>

                        <div style="display:flex; justify-content:flex-end; gap:12px; margin-top:16px;">
                            <button class="action-btn" id="btn-copy-text" style="border:1px solid var(--border);">
                                <i class="fa-solid fa-copy"></i> Copiar
                            </button>
                            <button class="action-btn" id="btn-download-audio" style="border:1px solid var(--border);">
                                <i class="fa-solid fa-file-audio"></i> Baixar √Åudio
                            </button>
                            <button class="btn-upload-trigger" id="btn-download-text"
                                style="margin:0; font-size:0.9rem;">
                                Baixar Transcri√ß√£o
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- REPORTS VIEW -->
            <div id="report-view" class="hidden">
                <div class="header-bar">
                    <div class="page-title" style="display: flex; align-items: center; gap: 16px;">
                        <div
                            style="width: 48px; height: 48px; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);">
                            <i class="fa-solid fa-chart-pie" style="font-size: 1.5rem; color: white;"></i>
                        </div>
                        <div>
                            <h1 style="margin: 0; font-size: 1.5rem;">Relat√≥rios</h1>
                            <p style="margin: 0; font-size: 0.85rem; color: var(--text-muted);">Estat√≠sticas de
                                performance</p>
                        </div>
                    </div>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Total</h3>
                        <p id="stat-total">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Procedente</h3>
                        <p id="stat-proced">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Improcedente</h3>
                        <p id="stat-improced">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Pendente</h3>
                        <p id="stat-pending">0</p>
                    </div>
                </div>
                <div class="glass-card" style="margin-top:24px; padding:24px; height:400px">
                    <canvas id="reportsChart"></canvas>
                </div>
            </div>

            <!-- ADMIN VIEW -->
            <div id="admin-view" class="hidden">
                <div class="header-bar">
                    <div class="page-title" style="display: flex; align-items: center; gap: 16px;">
                        <div
                            style="width: 48px; height: 48px; background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);">
                            <i class="fa-solid fa-user-shield" style="font-size: 1.5rem; color: white;"></i>
                        </div>
                        <div>
                            <h1 style="margin: 0; font-size: 1.5rem;">Administra√ß√£o</h1>
                            <p style="margin: 0; font-size: 0.85rem; color: var(--text-muted);">Gerenciamento do sistema
                            </p>
                        </div>
                    </div>
                </div>
                <div id="admin-content">
                    <!-- JS Populates this -->
                </div>
            </div>

            <!-- TERMINAL VIEW -->
            <div id="terminal-view" class="hidden">
                <div class="header-bar">
                    <div class="page-title">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div
                                style="width: 48px; height: 48px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);">
                                <i class="fa-solid fa-terminal" style="font-size: 1.5rem; color: white;"></i>
                            </div>
                            <div>
                                <h1
                                    style="margin: 0; font-size: 1.5rem; background: linear-gradient(135deg, #10b981 0%, #059669 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                                    Terminal do Servidor</h1>
                                <p style="margin: 0; font-size: 0.85rem; color: var(--text-muted);">Monitoramento em
                                    tempo real</p>
                            </div>
                        </div>
                    </div>
                    <div style="display:flex; align-items:center; gap:12px;">
                        <button class="action-btn" id="terminal-pause-btn" onclick="toggleTerminalPause()"
                            style="border:1px solid var(--border); background: var(--bg-card); padding: 8px 14px; display: flex; align-items: center; gap: 6px; transition: all 0.3s ease;">
                            <i class="fa-solid fa-pause" id="terminal-pause-icon"></i>
                            <span id="terminal-pause-text">Pausar</span>
                        </button>
                        <button class="action-btn" onclick="copyTerminalLogs()"
                            style="border:1px solid var(--border); background: var(--bg-card); padding: 8px 14px; display: flex; align-items: center; gap: 6px;">
                            <i class="fa-solid fa-copy"></i> Copiar
                        </button>
                        <button class="action-btn" onclick="clearTerminalDisplay()"
                            style="border:1px solid var(--border); background: var(--bg-card); padding: 8px 14px; display: flex; align-items: center; gap: 6px;">
                            <i class="fa-solid fa-eraser"></i> Limpar
                        </button>
                        <button class="action-btn delete" onclick="adminClearCache()"
                            style="border:1px solid var(--danger); background: var(--bg-card); color: var(--danger); padding: 8px 14px; display: flex; align-items: center; gap: 6px;">
                            <i class="fa-solid fa-trash"></i> Limpar Cache
                        </button>
                        <button class="action-btn" onclick="regenerateAllAnalyses()"
                            style="border:1px solid var(--primary); background: var(--bg-card); color: var(--primary); padding: 8px 14px; display: flex; align-items: center; gap: 6px;">
                            <i class="fa-solid fa-sync"></i> Regenerar An√°lises
                        </button>
                        <div
                            style="display: flex; align-items: center; gap: 6px; padding: 6px 12px; background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px;">
                            <div class="pulse-dot"
                                style="width: 8px; height: 8px; background: #10b981; border-radius: 50%; animation: pulse 2s ease-in-out infinite;">
                            </div>
                            <span style="font-size:0.8rem; color:var(--text-muted)">Auto-refresh (2s)</span>
                        </div>
                    </div>
                </div>

                <!-- Terminal Window -->
                <div class="terminal-window"
                    style="background: linear-gradient(135deg, rgba(15, 23, 42, 0.95) 0%, rgba(30, 41, 59, 0.95) 100%); border-radius: 16px; overflow: hidden; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px);">
                    <!-- Terminal Header -->
                    <div
                        style="background: linear-gradient(135deg, rgba(30, 41, 59, 0.8) 0%, rgba(15, 23, 42, 0.8) 100%); padding: 12px 16px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div
                                style="width: 12px; height: 12px; background: #ef4444; border-radius: 50%; box-shadow: 0 0 8px rgba(239, 68, 68, 0.5);">
                            </div>
                            <div
                                style="width: 12px; height: 12px; background: #f59e0b; border-radius: 50%; box-shadow: 0 0 8px rgba(245, 158, 11, 0.5);">
                            </div>
                            <div
                                style="width: 12px; height: 12px; background: #10b981; border-radius: 50%; box-shadow: 0 0 8px rgba(16, 185, 129, 0.5);">
                            </div>
                        </div>
                        <div
                            style="font-family: monospace; font-size: 0.75rem; color: rgba(255, 255, 255, 0.5); letter-spacing: 0.5px;">
                            mirror.ia@server ~ /var/log/app
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="font-size: 0.7rem; color: rgba(255, 255, 255, 0.4); font-family: monospace;">
                                <span id="terminal-line-count">0</span> linhas
                            </div>
                        </div>
                    </div>

                    <!-- Terminal Content -->
                    <div id="terminal-output"
                        style="background: transparent; color: #10b981; padding: 20px; font-family: 'Courier New', monospace; height: 600px; overflow-y: auto; white-space: pre-wrap; font-size: 0.85rem; line-height: 1.6; position: relative;">
                        <div style="display: flex; align-items: center; gap: 8px; color: rgba(16, 185, 129, 0.6);">
                            <i class="fa-solid fa-spinner fa-spin"></i>
                            <span>Carregando logs do servidor...</span>
                        </div>
                    </div>

                    <!-- Terminal Footer -->
                    <div
                        style="background: linear-gradient(135deg, rgba(30, 41, 59, 0.8) 0%, rgba(15, 23, 42, 0.8) 100%); padding: 8px 16px; display: flex; align-items: center; justify-content: space-between; border-top: 1px solid rgba(255, 255, 255, 0.1); font-family: monospace; font-size: 0.7rem; color: rgba(255, 255, 255, 0.5);">
                        <div style="display: flex; align-items: center; gap: 16px;">
                            <div style="display: flex; align-items: center; gap: 6px;">
                                <i class="fa-regular fa-clock"></i>
                                <span id="terminal-timestamp">--:--:--</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 6px;">
                                <i class="fa-solid fa-database"></i>
                                <span id="terminal-size">0 KB</span>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 6px;">
                            <span>UTF-8</span>
                            <span>|</span>
                            <span>LF</span>
                            <span>|</span>
                            <span>LOG</span>
                        </div>
                    </div>
                </div>
            </div>

            <style>
                @keyframes pulse {

                    0%,
                    100% {
                        opacity: 1;
                        transform: scale(1);
                    }

                    50% {
                        opacity: 0.5;
                        transform: scale(1.2);
                    }
                }

                @keyframes spin {
                    from {
                        transform: rotate(0deg);
                    }

                    to {
                        transform: rotate(360deg);
                    }
                }

                .terminal-window {
                    margin-top: 16px;
                    transition: all 0.3s ease;
                }

                .terminal-window:hover {
                    box-shadow: 0 25px 70px rgba(0, 0, 0, 0.6), 0 0 0 1px rgba(16, 185, 129, 0.2);
                }

                #terminal-output::-webkit-scrollbar {
                    width: 8px;
                }

                #terminal-output::-webkit-scrollbar-track {
                    background: rgba(15, 23, 42, 0.5);
                    border-radius: 4px;
                }

                #terminal-output::-webkit-scrollbar-thumb {
                    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
                    border-radius: 4px;
                }

                #terminal-output::-webkit-scrollbar-thumb:hover {
                    background: linear-gradient(135deg, #059669 0%, #047857 100%);
                }

                /* Log level colors */
                .log-info {
                    color: #60a5fa;
                }

                .log-warning {
                    color: #fbbf24;
                }

                .log-error {
                    color: #ef4444;
                }

                .log-success {
                    color: #10b981;
                }

                .log-debug {
                    color: #a78bfa;
                }
            </style>
    </div>

    <!-- JavaScript Principal - M√≥dulo ES6 -->
    <script type="module" src="/static/js/main.js?v={{ cache_bust }}"></script>
    <script src="/static/rules-manager.js?v={{ cache_bust }}" defer></script>
</body>

</html>