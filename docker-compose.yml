version: '3.8'

services:
  transcription-service:
    build: .
    env_file:
      - .env
    ports:
      - "8000:8000"
    volumes:
      - .:/app
      - whisper-models:/root/.cache/huggingface
      - uploads:/app/uploads
      - database:/app/data
    environment:
      - WHISPER_MODEL=${WHISPER_MODEL:-medium}
      - DEVICE=${DEVICE:-cuda}
      - COMPUTE_TYPE=${COMPUTE_TYPE:-int8_float16}
      - MAX_FILE_SIZE_MB=${MAX_FILE_SIZE_MB:-100}
      - ALLOWED_EXTENSIONS=${ALLOWED_EXTENSIONS:-mp3,wav,m4a,ogg,webm,flac}
      - DATABASE_PATH=${DATABASE_PATH:-/app/data/transcriptions.db}
      - CLEANUP_AFTER_HOURS=${CLEANUP_AFTER_HOURS:-24}
      - SECRET_KEY=${SECRET_KEY}
      - ALLOWED_ORIGINS=${ALLOWED_ORIGINS:-http://localhost:8000}
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [ gpu ]

volumes:
  whisper-models:
  uploads:
  database:
